(this["webpackJsonpred-tetris"]=this["webpackJsonpred-tetris"]||[]).push([[0],{81:function(e,t){},84:function(e,t){var n={server:{host:"localhost",port:"3004",get url(){return"http://"+this.host+":"+this.port}}};e.exports=n},85:function(e,t,n){},94:function(e,t,n){},95:function(e,t,n){},96:function(e,t,n){"use strict";n.r(t);var c=n(1),r=n(0),o=n.n(r),i=n(50),a=n.n(i),s=n(12),u=n(3),b=n(51),j=n.n(b),l=(n(84),j()("https://red-tetris-malg.herokuapp.com/")),f=o.a.createContext(l),d=n(2),O=n(10);var m=function(e,t){var n=Object(r.useRef)(null);Object(r.useEffect)((function(){n.current=e})),Object(r.useEffect)((function(){if(null!==t){var e=setInterval((function(){"undefined"!==typeof(null===n||void 0===n?void 0:n.current)&&(null===n||void 0===n||n.current())}),t);return function(){return clearInterval(e)}}}),[t])},h=n(11);var x={rotate:function(e,t,n){var c=e.x-t.x,r=e.y-t.y;return{x:Math.round(c*Math.cos(n)-r*Math.sin(n)+t.x),y:Math.round(c*Math.sin(n)+r*Math.cos(n)+t.y)}},translateX:function(e,t){return{x:e.x+t,y:e.y}},translateY:function(e,t){return{x:e.x,y:e.y+t}}};var p={rotate:function(e){return Object(h.a)(Object(h.a)({},e),{},{points:e.points.map((function(t){return x.rotate(t,e.center,90*Math.PI/180)}))})},Right:function(e){return Object(h.a)(Object(h.a)({},e),{},{position:x.translateX(e.position,1)})},Left:function(e){return Object(h.a)(Object(h.a)({},e),{},{position:x.translateX(e.position,-1)})},Down:function(e){return Object(h.a)(Object(h.a)({},e),{},{position:x.translateY(e.position,1)})}},v=(n(85),n(5)),g=n(6);function y(){var e=Object(v.a)(["\n  display: flex;\n  align-items: flex-start;\n  padding: 40px;\n  margin: 0 auto;\n  max-width: 900px;\n  aside {\n    width: 100%;\n    max-width: 200px;\n    display: block;\n    padding: 0 20px;\n  }\n"]);return y=function(){return e},e}function w(){var e=Object(v.a)(["\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n"]);return w=function(){return e},e}var k=g.a.div(w()),C=g.a.div(y());function N(){var e=Object(v.a)(["\n  box-sizing: border-box;\n  display: flex;\n  align-items: center; \n  margin: 0 0 20px 0;\n  padding: 20px;\n  border: 4px solid #333;\n  min-height: 30px;\n  width: 100%;\n  border-radius: 20px;\n  color: ",";\n  background: #000;\n  font-family: Pixel, Arial, Helvetica, sans-serif;\n  font-size: 0.8rem;\n"]);return N=function(){return e},e}var S=g.a.div(N(),(function(e){return e.gameOver?"red":"#999"})),R=function(e){var t=e.gameOver,n=e.text;return Object(c.jsx)(S,{gameOver:t,children:n})};function A(){var e=Object(v.a)(["\n  box-sizing: border-box;\n  margin: 0 0 20px 0;\n  padding: 20px;\n  min-height: 30px;\n  width: 100%;\n  border-radius: 20px;\n  border: none;\n  color: white;\n  background: #333;\n  font-family: Pixel, Arial, Helvetica, sans-serif;\n  font-size: 1rem;\n  outline: none;\n  cursor: pointer;\n"]);return A=function(){return e},e}var E=g.a.button(A()),z=function(e){var t=e.callback;return Object(c.jsx)(E,{onClick:t,children:"Start Game"})},D=o.a.memo(z);function M(){var e=Object(v.a)(["\n  box-sizing: border-box;\n  margin: 0 0 0.5vw 0;\n  padding: 0.5vw;\n  min-height: 0.1vw;\n  width: 100%;\n  border-radius: 1vw;\n  border: none;\n  color: white;\n  background: #333;\n  font-family: Pixel, Arial, Helvetica, sans-serif;\n  font-size: 1rem;\n  outline: none;\n  cursor: pointer;\n"]);return M=function(){return e},e}function P(){var e=Object(v.a)(["\n  box-sizing: border-box;\n  margin: 0 0 0.5vw 0;\n  padding: 1vw;\n  min-height: 0.2vw;\n  width: 100%;\n  border-radius: 1vw;\n  border: none;\n  color: white;\n  background: #333;\n  font-family: Pixel, Arial, Helvetica, sans-serif;\n  font-size: 1rem;\n  outline: none;\n  cursor: pointer;\n"]);return P=function(){return e},e}function H(){var e=Object(v.a)(["\n  display: flex;\n  overflow: auto;\n"]);return H=function(){return e},e}var J=g.a.div(H()),I=g.a.button(P()),L=g.a.button(M()),B=n(55),G=n.p+"static/media/tetris.7ffe6109.mp3",T=function(){var e=Object(r.useState)(.1),t=Object(d.a)(e,2),n=t[0],o=t[1],i=Object(r.useState)(!1),a=Object(d.a)(i,2),s=a[0],u=a[1],b=Object(B.a)(G,{volume:s?0:n}),j=Object(d.a)(b,2),l=j[0],f=j[1].stop;return Object(r.useEffect)((function(){return l(),function(){f()}}),[l]),Object(c.jsxs)(J,{children:[Object(c.jsx)(L,{className:"btn btn-danger",onClick:function(){o(n-.01)},children:"-"}),Object(c.jsx)(I,{className:"btn btn-danger",onClick:function(){u(!s)},children:s?"Unmute":"Mute"}),Object(c.jsx)(L,{className:"btn btn-danger",onClick:function(){o(n+.01)},children:"+"})]})};function U(){var e=Object(v.a)(["\n  box-sizing: border-box;\n  margin: 0 0 20px 0;\n  padding: 20px;\n  min-height: 30px;\n  width: 100%;\n  border-radius: 20px;\n  border: none;\n  color: white;\n  background: #333;\n  font-family: Pixel, Arial, Helvetica, sans-serif;\n  font-size: 1rem;\n  outline: none;\n  cursor: pointer;\n"]);return U=function(){return e},e}var X=g.a.button(U()),Z=function(){var e=Object(r.useContext)(f),t=Object(u.e)();return Object(c.jsx)("div",{children:Object(c.jsx)(X,{className:"btn btn-danger",onClick:function(){e.emit("leaveRoom"),t.push("/Room")},children:"Leave Room"})})},Y=function(e){return Object(c.jsxs)("aside",{children:[e.gameOver?Object(c.jsx)(R,{gameOver:e.gameOver,text:"Game Over"}):Object(c.jsxs)("div",{children:[Object(c.jsx)(T,{}),Object(c.jsx)(R,{text:"Score: ".concat(e.score)})]}),Object(c.jsx)(D,{callback:e.startGame}),Object(c.jsx)(Z,{})]})},K=function(){var e=Object(r.useContext)(f),t=10,n=20,o=Object(r.useState)(!1),i=Object(d.a)(o,2),a=i[0],s=i[1],u=Object(r.useState)([]),b=Object(d.a)(u,2),j=b[0],l=b[1],h=Object(r.useState)({}),x=Object(d.a)(h,2),v=x[0],g=x[1],y=Object(r.useState)(new Array(n).fill().map((function(e){return new Array(t).fill("white")}))),w=Object(d.a)(y,2),N=w[0],S=w[1],R=Object(r.useState)(new Array(n).fill().map((function(e){return new Array(t).fill(0)}))),A=Object(d.a)(R,2),E=A[0],z=A[1],D=Object(r.useState)([]),M=Object(d.a)(D,2),P=M[0],H=M[1],J=Object(r.useState)(!1),I=Object(d.a)(J,2),L=I[0],B=I[1],G=Object(r.useState)(0),T=Object(d.a)(G,2),U=T[0],X=T[1],Z=function(e){return!!e.points.find((function(c){var r=e.position.x+c.x,o=e.position.y+c.y;return r<0||r>=t||o<0||o>=n||"white"!==N[o][r]}))},K=function(e){var t=E.map((function(e){return e.map((function(e){return 0}))}));g(e),e.points.map((function(n){t[e.position.y+n.y][e.position.x+n.x]=1})),z(Object(O.a)(t))},q=function(){var c=Object(O.a)(N);v.points.map((function(e){c[v.position.y+e.y][v.position.x+e.x]=v.color})),e.emit("updateSpectrum",function(){for(var e=[],c=0;c<t;++c){for(var r=0,o=0;o<n;++o)"white"===N[o][c]&&++r;e.push(r)}return e}()),S(Object(O.a)(c));var r=j.shift();j.length<3&&e.emit("getTetris",(function(e){l((function(t){return[].concat(Object(O.a)(t),[e])}))})),Z(r)?(B(!0),s(!1)):(!function(){var n=Object(O.a)(N),c=0;N.map((function(r,o){r.find((function(e){return"white"===e||"grey"===e}))||(c+=100,n.splice(o,1),n.splice(0,0,new Array(t).fill("white")),e.emit("sendBlackbar"))})),X((function(e){return e+(400===c?2*c:c)})),S(n)}(),K(r))};Object(r.useEffect)((function(){for(var e=[],r=0;r<n;++r){for(var o=[],i=0;i<t;++i)o.push(Object(c.jsx)("td",{style:{backgroundColor:E[r][i]?v.color:N[r][i]}},"".concat(r*t+i)));e.push(Object(c.jsx)("tr",{children:o},"".concat(r)))}H(e)}),[E]),m((function(){!L&&a&&(Z(p.Down(v))?q():K(p.Down(v)))}),1e3),Object(r.useEffect)((function(){e.on("getBlackbar",(function(){S((function(e){return e.splice(n,0,new Array(t).fill("grey")),e.splice(0,1),e}))}))}),[]),Object(r.useEffect)((function(){e.on("newTetris",(function(e){l((function(t){return[].concat(Object(O.a)(t),[e])}))}))}),[]),Object(r.useEffect)((function(){e.on("getSetTetris",(function(e){var t=e.shift(),n=Object(O.a)(N);s(!0),n=n.map((function(e){return e.map((function(e){return"white"}))})),S(n),l(Object(O.a)(e)),g(t),K(t),B(!1),X(0)}))}),[]);return Object(c.jsx)(k,{role:"button",tabIndex:"0",onKeyDown:function(e){window.addEventListener("keydown",(function(e){[32,37,38,39,40].indexOf(e.keyCode)>-1&&e.preventDefault()}),!1),function(e){37===e.keyCode?Z(p.Left(v))||K(p.Left(v)):39===e.keyCode?Z(p.Right(v))||K(p.Right(v)):38===e.keyCode?Z(p.rotate(v))||K(p.rotate(v)):40===e.keyCode&&(Z(p.Down(v))?q():(X((function(e){return e+1})),K(p.Down(v))))}(e)},children:Object(c.jsxs)(C,{children:[Object(c.jsx)("table",{children:Object(c.jsx)("tbody",{children:P})}),Object(c.jsx)(Y,{gameOver:L,startGame:function(){e.emit("start")},score:U})]})})},q=function(){var e=Object(r.useContext)(f),t=Object(r.useState)({}),n=Object(d.a)(t,2),o=n[0],i=n[1],a=Object(r.useState)({}),s=Object(d.a)(a,2),b=s[0],j=s[1],l=Object(u.e)(),O=/#([a-zA-Z]+)\[([a-zA-Z]+)\]/;return Object(r.useEffect)((function(){O.exec(location.hash)?e.emit("getMyRoom",(function(e,t){e?l.push("/Home"):(j(t),i(t.players))})):l.push("/Home")}),[e]),Object(r.useEffect)((function(){e.on("updatePlayers",(function(e){i(e)}))}),[o,e]),Object(c.jsxs)("div",{className:"container",children:[Object(c.jsx)("h1",{children:b.name}),Object.keys(o).map((function(e,t){return Object(c.jsx)("p",{children:o[e].name},t)})),Object(c.jsx)(K,{})]})},F=function(){var e=Object(u.e)();return Object(c.jsxs)("div",{className:"container",children:[Object(c.jsx)("h1",{children:"Bienvenue sur Red Tetris"}),Object(c.jsx)("button",{className:"btn btn-danger",onClick:function(){e.push("/Room")},children:"Play"})]})},Q=(n(94),function(){var e=Object(r.useContext)(f),t=Object(u.e)(),n=Object(r.useState)({}),o=Object(d.a)(n,2),i=o[0],a=o[1];return Object(r.useEffect)((function(){e.emit("getRooms",(function(e){a(e)}))}),[e]),Object(r.useEffect)((function(){e.on("updateRooms",(function(e){a(e)}))}),[i]),Object(c.jsxs)("div",{className:"container",children:[Object(c.jsx)("h1",{children:"Room list"}),Object(c.jsx)("div",{className:"list-group mb-3",children:Object.keys(i).map((function(e,n){return Object(c.jsxs)("li",{className:"list-group-item p-1",children:[Object(c.jsxs)("label",{children:[Object(c.jsx)("b",{children:i[e].name})," ",Object(c.jsxs)("b",{children:["(",Object.keys(i[e].players).length,")"]})]}),Object(c.jsx)("button",{className:"btn btn-danger float-right",onClick:function(){return n=i[e].name,void t.push("/Join-room#".concat(n));var n},children:"Join"})]},n)}))}),Object(c.jsx)("button",{className:"btn btn-danger",onClick:function(){t.push("/New-room")},children:"Create New Room"})]})}),V=function(){var e=Object(r.useContext)(f),t=Object(u.e)(),n=Object(r.useState)(""),o=Object(d.a)(n,2),i=o[0],a=o[1],s=Object(r.useState)(""),b=Object(d.a)(s,2),j=b[0],l=b[1];return Object(c.jsxs)("div",{className:"container",children:[Object(c.jsx)("h1",{children:"New Room Creation"}),Object(c.jsxs)("form",{children:[Object(c.jsx)("div",{className:"form-group",children:Object(c.jsx)("input",{className:"form-control",type:"text",placeholder:"Username",onChange:function(e){a(e.target.value)}})}),Object(c.jsx)("div",{className:"form-group",children:Object(c.jsx)("input",{className:"form-control",type:"text",placeholder:"Room name",onChange:function(e){l(e.target.value)}})}),Object(c.jsx)("input",{className:"btn btn-danger",type:"submit",value:"Create",onClick:function(n){n.preventDefault(),i&&j&&(e.emit("join",i),e.emit("addRoom",j,(function(e){e?alert("Room name already exist"):t.push("/#".concat(j,"[").concat(i,"]"))})))}})]})]})},W=function(){var e=Object(r.useContext)(f),t=Object(r.useState)(""),n=Object(d.a)(t,2),o=n[0],i=n[1],a=Object(r.useState)(""),s=Object(d.a)(a,2),b=s[0],j=s[1],l=Object(u.e)(),O=/#([a-zA-Z]+)/;Object(r.useEffect)((function(){j(O.exec(location.hash)[1])}),[location.hash]);return Object(c.jsxs)("div",{className:"container",children:[Object(c.jsxs)("h1",{children:['Join "',b,'"']}),Object(c.jsxs)("form",{children:[Object(c.jsx)("div",{className:"form-group",children:Object(c.jsx)("input",{className:"form-control",placeholder:"Username",onChange:function(e){i(e.target.value)}})}),Object(c.jsx)("input",{className:"btn btn-danger",type:"submit",value:"Join",onClick:function(t){t.preventDefault(),o&&(e.emit("join",o),e.emit("joinRoom",b,(function(e){e?alert("Username already taken"):l.push("/#".concat(b,"[").concat(o,"]"))})))}})]})]})},$=(n(95),function(){return Object(c.jsx)(f.Provider,{value:l,children:Object(c.jsxs)(s.a,{children:[Object(c.jsx)(u.a,{path:"/",exact:!0,component:q}),Object(c.jsx)(u.a,{path:"/Home",component:F}),Object(c.jsx)(u.a,{path:"/Room",component:Q}),Object(c.jsx)(u.a,{path:"/New-room",component:V}),Object(c.jsx)(u.a,{path:"/Join-room",component:W})]})})});a.a.render(Object(c.jsx)($,{}),document.getElementById("tetris"))}},[[96,1,2]]]);
//# sourceMappingURL=main.43942781.chunk.js.map